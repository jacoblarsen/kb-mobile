<project name="aleph-gateway" basedir="." default="compile">
	
	<property name="lib.dir" value="lib" />
	<property name="cop.common.conf" value="../conf" />
	<property name="src.dir" value="src" />
	<property name="class.dir" value="classes" />
	<property name="jar.dir" value="bin" />

	<!-- Set Classpath equal to what is needed -->
	<path id="classpath">
		<fileset dir="${lib.dir}" includes="**/*.jar" />
	</path>

	<!-- Delete everything autogenerated files -->
	<target name="clean" description="Clean the project">
		<delete dir="${class.dir}" />
		<delete dir="${jar.dir}" />
		<delete file="${lib.dir}/${ant.project.name}-simple.jar"/>
	</target>

	<!--Compile the module  -->
	<target name="compile" description="Compiles the whole bundle">
		<mkdir dir="${class.dir}" />
		<javac srcdir="${src.dir}" destdir="${class.dir}" classpathref="classpath">
		</javac>
	</target>

	<!--Create simple jar file  -->
	<target name="jar" depends="clean, compile" description="Create simple jar file">
		<jar destfile="${lib.dir}/${ant.project.name}-simple.jar">
		    <fileset dir="${class.dir}" />
		    <manifest>
				<attribute name="Main-Class" value="dk.kb.dis.alephtools.xserverGateway.Xserver"/>
			</manifest>
		</jar>
	</target>
	
	<!--Create an executable jar file - takes ~30sec -->
	<target name="jar-exe" depends="clean, compile" description="Create an executable jar file">
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/${ant.project.name}-executable.jar">
		    <fileset dir="${class.dir}" />
		    <restrict>
		        <name name="**/*.class"/>
		        <archives>
		            <zips>
		                <fileset dir="${lib.dir}" includes="**/*.jar"/>
		            </zips>
		        </archives>
		    </restrict>
		    <manifest>
				<attribute name="Main-Class" value="dk.kb.dis.alephtools.xserverGateway.Xserver"/>
				<attribute name="Class-Path" value="lib/jetty-all-7.0.2.v20100331.jar lib/servlet-api-2.5.jar"/>
			</manifest>
		</jar>
	</target>

	<!--Run jetty from ant  -->
	<target name="run" depends="jar" description="Run jetty from ant">
		<java classname="dk.kb.dis.alephtools.xserverGateway.Xserver" classpathref="classpath" fork="true"/>
	</target>

</project>
